generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id    Int     @id @default(autoincrement())
  email String  @unique
  name  String?
}

model Location {
  id        Int        @id @default(autoincrement())
  name      String     @unique @db.VarChar(100)
  employees Employee[]
}

model Employee {
  employee_id            Int                @id @default(autoincrement())
  full_name              String             @db.VarChar(255)
  role                   String?            @db.VarChar(255)
  location_id            Int?
  location               Location?          @relation(fields: [location_id], references: [id])
  seniority              String?            @db.VarChar(50)
  total_experience_years Int?
  skills                 EmployeeSkill[]
  languages              EmployeeLanguage[]
  projectTeams           ProjectTeam[]
}

model Skill {
  skill_id       Int             @id @default(autoincrement())
  skill_name     String          @unique @db.VarChar(100)
  employeeSkills EmployeeSkill[]
  projectSkills  ProjectSkill[]
}

model EmployeeSkill {
  employee_id      Int
  skill_id         Int
  experience_years Int      @default(0)
  employee         Employee @relation(fields: [employee_id], references: [employee_id], onDelete: Cascade)
  skill            Skill    @relation(fields: [skill_id], references: [skill_id], onDelete: Cascade)

  @@id([employee_id, skill_id])
  @@index([employee_id])
  @@index([skill_id])
}

model Language {
  language_id       Int                @id @default(autoincrement())
  language_name     String             @unique @db.VarChar(50)
  employeeLanguages EmployeeLanguage[]
}

model EmployeeLanguage {
  employee_id Int
  language_id Int
  employee    Employee @relation(fields: [employee_id], references: [employee_id], onDelete: Cascade)
  language    Language @relation(fields: [language_id], references: [language_id], onDelete: Cascade)

  @@id([employee_id, language_id])
  @@index([employee_id])
  @@index([language_id])
}

model Project {
  project_id   Int                @id @default(autoincrement())
  project_name String             @db.VarChar(100)
  description  String?            @db.Text
  skills       ProjectSkill[]
  seniority    ProjectSeniority[]
  team         ProjectTeam[]
}

model ProjectSkill {
  project_id           Int
  skill_id             Int
  min_experience_years Int     @default(0)
  project              Project @relation(fields: [project_id], references: [project_id], onDelete: Cascade)
  skill                Skill   @relation(fields: [skill_id], references: [skill_id], onDelete: Cascade)

  @@id([project_id, skill_id])
  @@index([project_id])
  @@index([skill_id])
}

model ProjectSeniority {
  project_id      Int
  seniority_level String  @db.VarChar(50)
  required_count  Int     @default(1)
  project         Project @relation(fields: [project_id], references: [project_id], onDelete: Cascade)

  @@id([project_id, seniority_level])
  @@index([project_id])
}

model ProjectTeam {
  project_id  Int
  employee_id Int
  score       Float?
  project     Project  @relation(fields: [project_id], references: [project_id], onDelete: Cascade)
  employee    Employee @relation(fields: [employee_id], references: [employee_id], onDelete: Cascade)

  @@id([project_id, employee_id])
  @@index([project_id])
  @@index([employee_id])
}
